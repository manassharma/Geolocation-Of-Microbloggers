import tweepy
from pymongo import MongoClient
import time
import logging

#2281953475, 526256506, 3165290299, 132385468, 113419517, 513067381, 87170183, 57928790, 132385468, 145125358, 5520952, 3003172754, 295026890, 2243499816, 108216910, 267187224, 729997920, 264034657, 87174678, 850869517, 195703895, 113278275, 128829414, 31798899, 118093900, 610695868, 1129278218, 56042688, 17482727, 213444489, 50109813, 18948541, 409089061, 84276772, 57188977, 41814169, 613321095, 492893104, 156967233, 643443, 389974129, 147139743, 417632438, 13058232, 12925072, 19675870, 44635677, 133880286, 44409004, 146169170, 67551899, 145125358, 40441273, 135421739, 128155589, 97169575, 111615736, 23592970, 87118217, 75854417, 114501238, 113419517, 17753033, 53790896, 27602673, 86254626, 101695592, 24705126, 92211391, 67602060, 58153957, 57947582, 70179948, 66421178, 56631494, 53555106, 97865628, 18681139, 40884854, 19929890, 87170183, 34197952, 56304605, 101314413, 57998991, 57928790, 14075928, 91221097, 132385468, 14824849, 188892930, 19329393, 15485441, 32171318, 51574477, 50539213, 12044602, 180531059, 24670677, 112915037, 22677790, 257400398, 123774113, 132385468, 2887900697, 112082982, 88856792, 158761774, 568825492, 57928790, 560084912, 31348594, 3072640369, 15163777, 145125358, 100653504, 989429790, 101311381, 97614907, 1286178114, 57998991, 79424503, 853636442, 18839785, 487843424, 18681139, 123774113, 132859239, 132385468, 14159148, 17137628, 39511166, 3114313702, 19878121, 3072640369, 32546266, 1277116148, 3010685928, 1492538024, 2903484548, 249325843, 1547435844, 2839779443, 28007444, 389898091, 771906360, 202996089, 2736087561, 132859239, 393986838, 950165300, 361848817, 91080941, 2450925277, 95252395, 613321095, 69229721, 59723755, 1356593833, 43880881, 2478131676, 57024049, 53556894, 713600472, 190692903, 2469605695, 1329528684, 20959357, 108936259, 40884854, 183541994, 66092787, 2427497641, 1624999796, 61253025, 2391290797, 2203116894, 332788870, 1713721584, 90413046, 2321806382, 249962279, 2301978504, 2295978512, 43042353, 27022925, 337502808, 44588485, 180505807, 144755081, 89942256, 1748125447, 440613765, 97518519, 769727912, 1893973736, 1854035929, 40450960, 1057840951, 854988012, 1716555583, 118989667, 1469786928, 747811742, 452638864, 490982935, 64049044, 1697240010, 700568101, 1694691012, 1358403504, 1519951814, 328350939, 1688102900, 55250990, 106415237, 34377323, 312558905, 50070883, 1645884218, 1635565670, 237093109, 16983244, 60893125, 133880286, 1559820331, 1464109963, 79424503, 1459583899, 969509659, 439488777, 366947884, 127731360, 102382667, 49239873, 20609518, 15093629, 68399194, 69615397, 63796828, 61126132, 153474021, 111710640, 1404219716, 64181763, 49263800, 1060142971, 287015836, 78022296, 29650784, 49551150, 33323849, 52132491, 19100811, 20258334, 97294814, 141052723, 344634424, 195703895, 31239408, 79293791, 24599923, 88856792, 145125358, 126765449, 178266264, 132385468, 92726549, 87170183, 56631494, 57928790, 18681139, 86254626, 101311381, 97865628, 101695592, 66334209, 51376979, 113419517, 31348594, 98932084, 65659343, 115341081, 93622144, 99642673, 24382574, 18676177, 57998991, 27602673, 61197829, 41364508, 44345790, 79806178, 66075817, 23635387, 1243126304, 861987572, 2922680586, 1492334274, 132859239, 284989979, 267107552, 88856792, 101311381, 2435798060, 38127175, 136530458, 73043514, 21961038, 1072993274, 107474787, 87174678, 2843197753, 471014302, 1624707968, 50228660, 2803191, 100480895, 90628174, 764334150, 323346776, 1552108188, 2378710598, 37034483, 163494535, 134758540, 60737306, 37168231, 15163777, 385926583, 17717614, 56304605, 57188977, 123774113, 46373774, 20609518, 66366766, 1667122507, 113352671, 76134964, 1941991382, 94163409, 323983082, 1917252864, 1894322233, 332188446, 59983585, 371730289, 551757469, 115341081, 181135181, 129721182, 1620112368, 249329555, 1117138759, 255117773, 125325790, 140773806, 41293789, 155461439, 132385468, 112661068, 343181827, 122626161, 40884854, 101311381, 883830318, 580947653, 2843197753, 1028211162, 103565377, 1542533869, 3072640369, 223536681, 185343466, 1139649950, 92726549, 26702766, 57998991, 51376979, 614156493, 795976950, 1492334274, 613321095, 123774113, 132859239, 819165488, 389974129, 724076588, 361206862, 207888272, 894885128, 97865628, 132385468, 121677709, 15383958, 171170960, 124730481, 62844258, 101030347, 24655957, 101729256, 101026945, 100797226, 100653504, 9822482]
user_ids = [1444554295]
# authentication for using twitter api
authorization_object = tweepy.OAuthHandler('q0FPYbzctolJ3tCwHc5PBd0IF',
                                           'c1zshTpZ0YnoafJueyIpo6StrOTybcKLSqQsRlLbzVrjF0a83j')
authorization_object.set_access_token('604340177-SH2zgSFwY3hT9NeTxGBgkBeE1fealGTHwVhb4EAN',
                                      'nq00oY0Bxwv6LhvOdUxf2HUMYL0VTwanPakuVt4sjPduy')
tweepy_api = tweepy.API(authorization_object)

client = MongoClient()
db = client.twitter

logging_location = 'history.log'
logging.basicConfig(filename=logging_location,level=logging.DEBUG)

for user_id in user_ids:
    try:
        logging.debug(user_id)
        user = tweepy_api.get_user(user_id)
        friends_list = []
        try:
            time.sleep(60);
            items = tweepy.Cursor(tweepy_api.friends, screen_name=user.screen_name).items()
            time.sleep(60);


            for friend in items:
                file_open = open("C:/data/user_friends.csv", "a")
                file_open.write(str(user_id) + "," + str(friend.id))
                file_open.write('\n')
                friends_list.append(friend.id)
                user_ids.append(friend.id)

            file_open.close()
            logging.debug("Processed friends for user id: " + str(user_id))

            file_open = open("C:/data/user_ids_and_friends_count.csv", "a")
            file_open.write(str(user_id) + "," + str(len(friends_list)))
            file_open.write('\n')
            file_open.close()
        except Exception:
            logging.debug("Error fetching friends for user :" + str(user_id))
            pass


        user_response = {'user_id': user.id,
                         'user_name': user.screen_name,
                         'follower_ids': user.followers_ids(),
                         'friend_ids': friends_list,
                         'profile_location': user.location}

        file_open = open("C:/data/user_ids_and_location.csv", "a")
        file_open.write(str((str(user_id) + "," + user.location).encode("UTF-8")))
        file_open.write('\n')
        file_open.close()

        logging.debug('Processed successfully for  user : ')
        logging.debug(str(user.screen_name))

    except Exception:
        logging.debug("Program stopped processing!!!")
        logging.debug(user_ids)
        pass
        raise
#        logging.debug('Error processing ', str(user_id)